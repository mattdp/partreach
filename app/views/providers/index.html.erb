<% provide(:title,"Provider index") %>

<div class="container hax-body-styling">
  <div class="row">
    <div class="main-area-contrast override">
      <!-- this tool was super helpful making quick tables: http://www.textfixer.com/html/csv-convert-table.php -->

      <%= render :partial => "providers/providers_header" %>      

      <% if @results_hash.present? %>
        <h2 class="center">Results of your search for <%= "#{@search_text}" %></h2>

        <% @results_hash.each do |header, providers| %>
          <div class="col-md-12">
            <h2>
              <span><%= header %></span>
            </h2>
            <% if providers %> 
              <%= render :partial => "providers/providers_table", locals: {providers: providers} %>
            <% end %>
            <% else %>
              <p>We don't have any suppliers fitting this description. Help out by <%= mail_to "founders@supplybetter.com", "submitting one now" %>!</p>
          </div>
        <% end %>
      <% end %>

    </div>
  </div>
  <% if @recent_comments.present? %>
    <h2 class="center">Recent Reviews and Comments</h2>
    <div class="row ">          
      <% @recent_comments.each do |comment| %>
        <div class="row">
          <div class="col-md-12">
            <hr class="header-no-margin">
              <p class="small-margin-left">
                <%= "#{comment.updated_at.strftime('%m/%d')}: " %>
                <strong><%= "#{comment.user.lead.lead_contact.name}" %></strong>
                left a 
                <% if comment.overall_score > 0 %>                  
                  <%= render partial: "providers/star_display", locals: {score: comment.overall_score, include_hidden_number: false} %>
                <% end %>
                <% po = comment.purchase_order %>
                <% if po.present? %>
                  <%= link_to "review", teams_profile_path(comment.provider.name_for_link, :anchor => comment.id) %> 
                <% else %>
                  <%= link_to "comment", teams_profile_path(comment.provider.name_for_link, :anchor => comment.id) %> 
                <% end %>
                for                
                <%= link_to "#{comment.provider.name}", teams_profile_path(comment.provider.name_for_link) %>                
                <% if po.present? %>
                  regarding a 
                  <% po.tags.each do |tag| %>
                    <span class="tags-providerTags"><a id="index-tags"><%= tag.readable %></a></span>
                  <% end %>                
                order 
                (Project Name: <span><%= "#{po.project_name}" if po.project_name %></span>)
                <% end %>                
              </p>
          </div>
        </div>
      <% end %>          
    </div>
  <% end %>
</div>