<% provide(:title, "Manipulate dialogues") %>

<h1><%= "Changes to Order \##{@order.id} (User #{User.find(@order.user_id).name})"  %></h1>	

<%= render "layouts/order_basics" %>

<p> <%= link_to "Add a dialogue", "/dialogues/new/#{@order.id}" %> | Note: if you want erase an existing numeric field, set it to 0, do not simply delete it.</p>

<%= form_tag :action => 'update_dialogues', :controller => 'orders' do %>

	<%= hidden_field_tag "id", @order.id %>

	<table>
		<th>d_id</th>
		<th>Supplier</th>
		<% [@checkboxes,@textfields,@numberfields].each do |set| %>
			<% set.each do |h| %>
				<th>
					<% if set == @checkboxes %>
						<%= "" %>
					<% else %>
						<%= "#{h.to_s}" %>
					<% end %>
				</th>
			<% end %>
		<% end %>
		<% @dialogues.each do |d| %>
			<tr>
				<td><%= "#{d.id}" %></td>
				<td><%= "#{Supplier.find(d.supplier_id).name}" %>
				<% @checkboxes.each do |c| %>
					<td class="center">
						<%= check_box_tag "#{d.id}[#{c.to_s}][]", d.id, d.attributes[c.to_s] %>
					</td>
				<% end %>
				<% @textfields.each do |t| %>
					<td>
						<%= text_field_tag "#{d.id}[#{t.to_s}_field]", d.attributes[t.to_s] %>
					</td>
				<% end %>
				<% @numberfields.each do |n| %>
					<td>
						<%= text_field_tag "#{d.id}[#{n.to_s}_field]", d.attributes[n.to_s] %>
					</td>
				<% end %>
			</tr>
		<% end %>
	</table>

	<p>Ordering of checkboxes:</p>
	<div><% @checkboxes.each do |c| %>
		<%= "| #{c.to_s}" %>
	<% end %></div>

	<%= submit_tag "Save changes", :disable_with => "Saving..." %>

<% end %>	