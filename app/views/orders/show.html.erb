<% provide(:title, "Details of quote request") %>

<div class="container">
  <div class="row">
  	<div class="col-sm-10 col-sm-offset-1 main-area-contrast override order">

			<h3 class="bit-of-space">Details of quote request</h3>

			<% if @order.errors.any? %>
			  <div class="error_explanation">
			    <h2><%= pluralize(@order.errors.count, "error") %> prohibited this order from being saved:</h2>
			    <ul>
			      <% @order.errors.full_messages.each do |msg| %>
			        <li><%= msg %></li>
			      <% end %>
			    </ul>
			  </div>
			<% end %>

			<%= render 'layouts/order_basics' %>

			<% if @order_groups and @order.dialogues.count > 0 %>
				<% @order_groups.each do |order_group| %>

					<h3 class="bit-of-space">
						<%= "#{order_group.name}" %>
						<%#= " (Process: #{order_group.process})" if order_group.process %>
					</h3>

					<% visibles = order_group.sort_visible_dialogues %>
					<% if visibles.present? %>
						<table class="order_table" cellspacing="0">
						  <tr class="order_table_header_row">
						    <th>Name</th>

						    <% @columns.each do |name,details| %>
						    	<th><%= "#{details[:header]}" %></th>
						    <% end %>

						    <th class="little-field">Selection</th>
						  </tr>

							<% visibles.each do |d| %>
								<% if d.recommended %>
									<tr class="recommended">
								<% else %>
									<tr>
								<% end %>

								<% s = Supplier.find(d.supplier_id) %>
								<td>
								<% if s.profile_visible %>
									<%= link_to "#{s.name}", supplier_profile_path(s.name_for_link) %>
								<% elsif !s.url_main.nil? and s.url_main != "" %>
									<%= link_to "#{s.name}", s.url_main %>
								<% else %>
									<%= s.name %>
								<% end %>
								</td>

								<% @columns.each do |name,details| %>
									<td class=<%= "#{details[:css_class]}" %>><%= eval("#{details[:code]}") %></td>
								<% end %>

								<td class="center"><%= link_to "Purchase!", "/orders/purchase/#{@order.id}/#{d.id}" %></td>
								</tr>
							<% end %>
						</table>
					<% else %>
						<p>No quotes have been received for this group of parts yet! We will notify you as soon as suppliers respond.</p>
					<% end %>

					<% if order_group.parts != [] %>
						<p><strong>Parts included in this group:</strong></p>
						<ul>
							<% order_group.parts.each do |part| %>
								<% part_string = "Quantity: #{part.quantity}" %>
								<% part_string = "#{part.name}, " + part_string if part.name %>
								<% part_string = part_string + ", BOM id: #{part.bom_identifier}" if part.bom_identifier %>
								<li><%= part_string %></li>
							<% end %>
						</ul>
					<% end %>

				<% end %>
			<% else %>
				<br>
				<p><strong>No quotes have been received yet! We will notify you as soon as suppliers respond.</strong></p>
			<% end %>

			<p class="back_to_home"><%= link_to 'Back to orders', orders_path %></p>

		</div>
	</div>
</div>
